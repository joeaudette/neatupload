<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Static Upload Page Example</title>
	<script type="text/javascript" src="../../NeatUpload/SWFUpload.js"></script>
	<script type="text/javascript" src="../../NeatUpload/NeatUpload.js"></script>
</head>
<body>
<form id="formID" action="StaticUploadHandler.ashx" method="post" enctype="multipart/form-data">
	InputFile: <input id="fileID" type="file" name="NeatUpload_replacedByScript-fileField" /><br />
	MultiFile:<br />
	<!-- Note: No space allowed between the next 2 elements.  The div must be the nextSibling of the input element. -->
	<input id="multiFileID" type="file" name="NeatUpload_replacedByScript-multiFileField" /><div id='NeatUploadDiv_multiFileID' style='position: relative; display: none;'>
		<input type="button" name="multiFileButton" value="Add Files..." id="multiFileButton" />
	</div><br />
	<input id="uploadButtonID" type="submit" name="upload" value="Upload with type='submit' Button" />
	<input id="uploadButtonID2" type="button" onclick="document.getElementById('formID').submit()" name="upload2" value="Upload by calling form.submit()" />
	<input id="cancelButtonID" type="submit" name="cancel" value="Cancel" /><br />
	<iframe id="progressDiv" style="width: 100%; height: 20em; border-width: 0px" src="Progress.htm"></iframe>
<script type="text/javascript">
	// Generate long random string so uploads don't interfere with each other.
	var initialPostBackID = Math.round(Math.random() * 1000000000);
	
	// The application path is the path to this page with the last 3 elements removed.
	var appPath = document.location.pathname.split('/').slice(0, -3).join('/');

	NeatUploadMultiFileCreate("multiFileID", initialPostBackID,
		appPath,
		appPath + '/NeatUpload/MultiRequestUploadHandler.ashx',
		'NeatUpload_PostBackID',
		{ 
			NeatUpload_PostBackID: initialPostBackID,
			NeatUpload_MultiRequestControlID: 'multiFileID',
			NeatUpload_ArmoredCookies: null
		},
		 true,
		 '',
		 '*.*',
		 '',
		 'NeatUploadDiv_multiFileID',
		 'NeatUploadConfig_multiFileID'
);

	NeatUploadInputFileCreate("fileID", initialPostBackID);

	var pb = new NeatUploadPB("progressDiv", initialPostBackID, "Progress.htm?barID=progressDiv", "500px", "100px", ["uploadButtonID", "uploadButtonID2"], "IsFilesToUpload()");
	NeatUploadPB.prototype.Bars["progressDiv"] = pb;

	var progressDiv = document.getElementById("progressDiv");
	pb.DisplayUrl = function(progressUrl) {
		var pb = this;
		var iframeWindow = document.getElementById(pb.ClientID).contentWindow || frames[pb.ClientID];
		// iframeWindow.document.body.innerHTML = '';
		// setTimeout(function() { iframeWindow.location.href = progressUrl; }, 0);
		iframeWindow.setTimeout("queryObj = { postBackID: '" + pb.UploadForm.GetPostBackID() + "', barID: '" + pb.ClientID + "', canCancel: " + pb.CanCancel() + " };", 1);
	};

	pb.EvalOnClose = null;

	// If the upload succeeds, StaticUploadHandler.ashx will redirecte the browser back to this page but
	// the postBackID of the upload will be passed in the query string.
	// If we find the postBackID in the query string we use it to display the status of the
	// completed upload.
	var queryParams = (document.location.search || '?').substring(1).split('&');
	var queryObj = { postBackID: null, numFilesReceived: 0 };
	for (var i = 0; i < queryParams.length; i++) {
		var qp = queryParams[i].split('=');
		queryObj[qp[0]] = qp[1];
	}
	if (queryObj.postBackID) {
		var iframeWindow = document.getElementById(pb.ClientID).contentWindow || frames[pb.ClientID];
		if (iframeWindow)
			iframeWindow.location.replace(pb.UploadProgressPath + '&postBackID=' + queryObj.postBackID + '&canCancel=' + pb.CanCancel());
	}
</script>
</form>
</body>
</html>
